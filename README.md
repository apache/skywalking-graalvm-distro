# SkyWalking GraalVM Distro (Experimental)
<img src="http://skywalking.apache.org/assets/logo.svg" alt="Sky Walking logo" height="90px" align="right" />

SkyWalking GraalVM Distro is a re-distribution of the official Apache SkyWalking OAP server, targeting GraalVM native image on JDK 25.

## Why a Re-Distribution?

SkyWalking OAP server relies heavily on runtime code generation and dynamic class loading — patterns that are fundamentally incompatible with GraalVM native image's closed-world assumption. This includes Javassist bytecode generation (~1,850 classes), Groovy dynamic compilation (~1,260 scripts), Guava classpath scanning, ServiceLoader discovery, and reflection-based configuration.

None of these work in a GraalVM native image out of the box.

This distro moves all dynamic code generation from runtime to build time. At build time, the full OAL/MAL/LAL initialization pipeline runs, captures all generated bytecode, and packages it into the native image classpath. At runtime, pre-compiled classes are loaded from manifests — no Javassist, no GroovyShell, no classpath scanning.

The **same-FQCN replacement** technique makes this transparent: classes in this distro share the exact fully-qualified name with their upstream counterparts. Maven classpath ordering ensures the replacement is loaded. No forking, no patching.

## Module Selection

This distro targets a **full-feature OAP server** with fixed module/provider selection:

- **Storage**: BanyanDB
- **Cluster**: Standalone, Kubernetes
- **Configuration**: Kubernetes
- **Receivers**: All (trace, meter, log, profile, browser, OTel, mesh, envoy, Zipkin, Zabbix, Telegraf, etc.)
- **Query**: GraphQL, PromQL, LogQL, Zipkin
- **Alarm, Telemetry, Exporter**: Enabled

See [DISTRO-POLICY.md](DISTRO-POLICY.md) for the full module table and build plan.

## Build

Requires GraalVM JDK 25.

```bash
# Initialize submodule
git submodule update --init --recursive

# Full build (precompiler + tests + server)
JAVA_HOME=/path/to/graalvm-jdk-25 make build-distro
```

## Project Structure

```
skywalking-graalvm-distro/
├── skywalking/                    # Git submodule — DO NOT MODIFY
├── build-tools/
│   ├── precompiler/               # Build-time OAL + MAL + LAL pre-compilation
│   └── config-generator/          # (planned) Build-time config code generation
├── oap-graalvm-server/
│   └── src/
│       ├── main/java/             # Same-FQCN replacement classes
│       └── test/java/             # 1,300 comparison tests
├── DISTRO-POLICY.md               # Build plan with phase tracking
├── OAL-IMMIGRATION.md             # OAL pre-compilation design
├── MAL-IMMIGRATION.md             # MAL pre-compilation design
└── LAL-IMMIGRATION.md             # LAL pre-compilation design
```

## Documentation

| Document | Description |
|---|---|
| [DISTRO-POLICY.md](DISTRO-POLICY.md) | Build plan, module selection, phase tracking, risk assessment |
| [OAL-IMMIGRATION.md](OAL-IMMIGRATION.md) | OAL (Observability Analysis Language) pre-compilation: Javassist class export, annotation scanning, runtime manifests |
| [MAL-IMMIGRATION.md](MAL-IMMIGRATION.md) | MAL (Meter Analysis Language) pre-compilation: Groovy script compilation, Javassist meter classes, combination pattern |
| [LAL-IMMIGRATION.md](LAL-IMMIGRATION.md) | LAL (Log Analysis Language) pre-compilation: static Groovy compilation, SHA-256 manifest lookup |

## License
Apache 2.0
